require(["jquery","validate","mylayer","base"],function(e,r,o,s){var a={init:function(){var r=this;e(".show_course_record_review").on("click",function(){var s=e(this).attr("order-id"),a=e(this).attr("data-id");if(0==e(".course_record_review_layer").size()){var i=e(".review_layer").html();o.init({title:"课程评论",content:i,no_remove:!0,class_name:"course_record_review_layer",layerClose:!1,success:function(){e(".review_form").find(".submit_review").show(),e(".review_form").validate(r.review_form_valid),e(".review_form").on("click",function(r){var i=e(this),t=r||window.event,c=e(t.target||t.srcElement);if(c.hasClass("submit_review")&&i.valid()){var n=i.serializeObject();n.order_id=s,n.course_record_id=a,e.postForm(c,"/api/course/order/record/review",n,function(e){"200"==e.code?o.showMessage("success",e.message,function(){window.location.reload()}):o.showMessage("error",e.message)})}}),e(".review_course_block").on("click",function(r){var o=e(this),s=r||window.event,a=e(s.target||s.srcElement),i=a;if(a.closest(".review_s").size()>0&&(i=a.closest(".review_s")),i.hasClass("review_s")){var t=s.offsetX,c=i.width(),n=Math.ceil(t/c*5);n>5&&(n=5),o.find(".score_value").val(n),o.find(".score_value_text").text(n),i.find(".review_s_value").width(n/5*c)}})}})}else e(".course_record_review_layer").addClass("show"),e(".overlay_course_record_review_layer").show()}),e(".load_course_record_review").on("click",function(){var r=e(this),s=e(this).attr("order-id"),a=e(this).attr("data-id"),i={};i.order_id=s,i.course_record_id=a,e.postForm(r,"/api/course/order/record/review/load",i,function(r){if("200"==r.code){var s=e(".review_layer").html();o.init({title:"课程评论",content:s,no_remove:!0,class_name:"course_record_review_layer",layerClose:!1,success:function(){e(".review_form").find(".submit_review").hide(),e(".review_form").find(".score_value").val(r.data.score),e(".review_form").find(".content_value").val(r.data.content),r.data.score>5&&(r.data.score=5),e(".score_value").val(r.data.score),e(".score_value_text").text(r.data.score);var o=e(".review_form").find(".score_value_s").width();e(".review_form").find(".review_s_value").width(r.data.score/5*o)}})}else o.showMessage("error",r.message)})}),e(".add_course_reserve").on("click",function(){var s=e(this).attr("order-id");if(0==e(".course_reserve_layer_block").size()){var a=e(".course_reserve_layer").html();o.init({title:"课程预约",content:a,no_remove:!0,class_name:"course_reserve_layer_block",layerClose:!1,success:function(){r.setReserveDate(),e(".course_reserve_form").validate(r.course_reserve_form_valid),e(".course_reserve_form").on("click",function(r){var a=e(this),i=r||window.event,t=e(i.target||i.srcElement);if(t.hasClass("submit_course_reserve")&&a.valid()){var c=a.serializeObject();c.order_id=s,e.postForm(t,"/api/course/order/reserve",c,function(e){"200"==e.code?o.showMessage("success",e.message,function(){window.location.reload()}):o.showMessage("error",e.message)})}})}})}else e(".course_reserve_layer_block").addClass("show"),e(".overlay_course_reserve_layer_block").show()}),e(".update_order_record_status").on("click",function(){var r=e(this),s=r.attr("data-confim");o.showConfirm(s,function(){var s=r.attr("data-id"),a=r.attr("data-status"),i={order_record_id:s,status:a};e.postForm(r,"/api/course/order/record/updatestatus",i,function(e){"200"==e.code?o.showMessage("success",e.message,function(){window.location.reload()}):o.showMessage("error",e.message)})})}),e(".btn_order_cancel").on("click",function(){var r=e(this);o.showConfirm("确认取消您的订单？",function(){var s=r.attr("order-id"),a={order_id:s};e.postForm(r,"/api/course/order/cancel",a,function(e){"200"==e.code?o.showMessage("success",e.message,function(){window.location.reload()}):o.showMessage("error",e.message)})})}),e(".order_status_link").on("click",function(){e.cachePut("order_status_link",!0)});var s=e.cacheGet("order_status_link");if(s){var a=e(".order_record_box").offset().top;window.scrollTo(0,a),e.cacheRemove("order_status_link")}e.validatorMessageConfig()}};a.setReserveDate=function(){if(void 0!=typeof laydate){laydate.skin("molv");var r={format:"YYYY-MM-DD hh:mm",istime:!0,istoday:!1,isclear:!1};e(".reserve_time").on("click",function(){laydate(r)})}},e(function(){a.init()})});