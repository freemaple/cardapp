require(["zepto","base","mylayer","validate","scrollComponent"],function(e,r,a,o,t){var s={init:function(){var r=this,o=e(".js-integral-records-list-box");t.init(),t.setScrollItem(o),t.setCallback(function(e,a){r.scrollLoadCallback(e,a)}),o.size()>0&&(o.addClass("loading"),e.ajaxGet("/api/integral/record",{page:"1"},function(e){o.removeClass("loading"),"Success"==e.code&&o.find(".js-integral-records-list").html(e.view)}));new FormValidator("integral-transfer-form",r.postValid,function(o,t){var s=e(t.target);if(s.find(".errormsg").html(""),o.length>0)return r.showValidatorError(o,s),!1;var n=s.serializeObject();a.showLoad(!0);return e.ajaxPost("/api/integral/transfer",n,function(r){"Success"==r.code?a.showTip(r.message,3e3,"success",function(){window.location.href="/account/integral",a.hideLoad()}):(a.hideLoad(),e.showRequestError(r))},function(r){a.hideLoad(),e.showRequestError(r)}),!1});e(".integral-transfer-form").on("submit",function(){return!1}),e(".payer_input").on("change",function(){var r=e(this).val();e.ajaxPost("/api/integral/payer/check",{payer:r},function(r){"Success"==r.code?e(".payer_user").val(r.data.user_name):""!=r.message&&a.showTip(r.message,3e3,"error")})}),e(document).on("click",".js-integral-toreward",function(){var r=e(".integral_toreward_amount").val(),o=e(".reward_transaction_password").val();r=parseFloat(r)?parseFloat(r):"",a.showConfirm("确定转换成余额？",function(){a.showLoad(!0);e.ajaxPost("/api/integral/toreward",{amount:r,transaction_password:o},function(e){a.hideLoad(),"Success"==e.code?(a.showTip(e.message,3e3,"success"),window.location.reload()):""!=e.message&&a.showTip(e.message,3e3,"error")})})}),e(".js-show-integral-toreward").on("click",function(){var r=e(this).attr("data-can-toreward");if("1"==r){var o=e("#toreward-template").html();a.init({content:o,close:!1,class_name:"layer-toreward",position:"center"})}else{var t=e(this).attr("data-tip");a.showTip(t,3e3,"error")}})},scrollLoadCallback:function(e,r){r.find(".js-integral-records-list").append(e)},postValid:[{name:"amount",rules:"required|decimal",message:{required:"请输入转账积分",decimal:"请输入数字金额"}},{name:"transaction_password",rules:"required",message:{required:"交易密码"}}],showValidatorError:function(r,a){for(var o=0,t=r.length;o<t;o++){var s=e(r[o].element);0==s.next(".errormsg").size()&&s.after('<div class="errormsg"></div>'),s.next(".errormsg").html(r[o].message)}var n=a.offset().top;window.scrollTo(0,n)}};"function"==typeof s.init&&e(function(){s.init()})});