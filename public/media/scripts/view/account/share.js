require(["zepto","base","mylayer","validate"],function(t,e,a,r){var n={init:function(){var e=this;t(".card-background-image").on("load",function(){t(".bg-btn").removeClass("hover")}),t(".card-background-item").on("click",function(){var e=t(this).find("img").attr("src"),a=t(this).attr("data-image");t(".card-background-item").removeClass("current"),t(this).addClass("current"),t(".card-background-image").attr("src",e).attr("data-image",a)}),t(".js-bg-left").on("click",function(){var a=e.getCurrent("left");t(".card-background-item").removeClass("current"),a.addClass("current");var r=a.attr("data-src"),n=a.attr("data-image");t(this).addClass("hover"),t(".card-background-image").attr("src",r).attr("data-image",n)}),t(".js-bg-right").on("click",function(){var a=e.getCurrent("right");t(".card-background-item").removeClass("current"),a.addClass("current");var r=a.attr("data-src"),n=a.attr("data-image");t(this).addClass("hover"),t(".card-background-image").attr("src",r).attr("data-image",n)}),t(".js-save-screen").on("click",function(){var r=t(".product_front_design"),n={left:parseFloat(r.css("left")),top:parseFloat(r.css("top")),width:r.width(),height:r.height()},o=t(".card-background-image").attr("data-image");a.showLoad(),t.ajaxPost("/api/account/share",{img:o,postion:n},function(r){if("Success"==r.code&&r.data){r.data;"undefined"!=typeof plus?t.saveFile(r.data,e.random()+".jpg",function(t){a.hideLoad(),a.showTip("图片已保存到手机相册,打开微信分享给朋友！",3e3,"success"),setTimeout(function(){window.open("weixin://")},3e3)}):a.hideLoad(),t(".screen-img").attr("src",r.data),t(".success-box").show(),t(".screen-box").hide(),t(".wrap-content").addClass("pd-small")}})})},getCurrent:function(e){var a=t(".card-background-item").length,r=t(".card-background-item.current").index();return 0==t(".card-background-item.current").size()&&(r=0),"right"==e?r==a-1?t(".card-background-item").first():t(".card-background-item").eq(r+1):"left"==e?0==r?t(".card-background-item").last():t(".card-background-item").eq(r-1):void 0},random:function(){var t=parseInt((new Date).getTime()/1e3),e=Math.floor(1e5*Math.random());return t+""+e},drop:function(){var e,a,r,n,o,i,c,s,d;t(".product_front_design").on("mousedown",function(o){n=t(this);var i=o||window.event;return e=i.clientX-parseFloat(n.css("left")),a=i.clientY-parseFloat(n.css("top")),r=!0,!1}),t(".design_front_zoom").on("mousedown",function(r){n=t(this).parent().find(".product_front_design");var u=r||window.event;return e=u.clientX,a=u.clientY,i=n.width(),c=n.height(),s=parseFloat(n.css("left")),d=parseFloat(n.css("top")),o=!0,!1}),t(document).on("mousemove",function(u){var l=u||window.event;t(u.target||u.srcElement);if(r){var g=l.clientX-e,f=l.clientY-a;n.css({left:g+"px",top:f+"px"})}else if(o){var m=l.clientX,p=(l.clientY,i+2*(m-e)),h=p/i,v=c*h;if(h>0){var b=s-(p-i)/2,w=d-(v-c)/2;n.css({width:p+"px",left:b+"px",top:w+"px"})}}}),t(document).on("mouseup",function(t){t||window.event;r=!1,o=!1})},mzoom:function(){var e,a,r,n,o,i,c,s,d;t(".product_front_design").on("touchstart",function(o){var i=o.targetTouches[0];return n=t(this),e=i.clientX-parseFloat(n.css("left")),a=i.clientY-parseFloat(n.css("top")),r=!0,!1}),t(document).on("touchmove",function(t){var u=t.targetTouches[0];if(r){var l=u.clientX-e,g=u.clientY-a;n.css({left:l+"px",top:g+"px"})}else if(o){var f=u.clientX,m=(u.clientY,i+2*(f-e)),p=m/i,h=c*p;if(p>0){var v=s-(m-i)/2,b=d-(h-c)/2;n.css({width:m+"px",left:v+"px",top:b+"px"})}}})}};"function"==typeof n.init&&t(function(){n.init()})});