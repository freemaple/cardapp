require(["zepto","base","mylayer"],function(t,o,a){var e={init:function(){var o=this;t(".js_logout_tip").on("click",function(){var o=t(this),e=!0;return a.showConfirm("确认退出帐号？",function(){return e=!1,window.location.href=o.attr("data-href"),!0}),!1}),t(".avatar-upload-form").on("change",function(e){var r=t(this),i=e||window.event,s=t(i.target||i.srcElement);if(s.hasClass("avatar-upload-file"))try{var c=s[0].files;if(c&&c.length>0){if(!c[0].type||t.inArray(c[0].type,["image/png","image/gif","image/jpg","image/jpeg"])==-1)return a.showTip(n.upload_image_format_tip,5e3,"error"),!1;if(c[0].size){var l=c[0].size/1048576;if(l>10)return a.showTip(n.upload_maximum_tip,5e3,"error"),!1}}o.avatarUload(r)}catch(t){}}),this.initInfo(),t(document).on("click",".js-reward-toIntegral",function(){var o=t(".reward_to_amount").val(),e=t(".reward_transaction_password").val();o=parseFloat(o)?parseFloat(o):"",a.showConfirm("确定转换成积分？",function(){a.showLoad(!0);t.ajaxPost("/api/account/reward/tointegral",{reward_amount:o,transaction_password:e},function(t){a.hideLoad(),"Success"==t.code?(a.showTip(t.message,3e3,"success"),window.location.reload()):""!=t.message&&a.showTip(t.message,3e3,"error")})})}),t(".js-show-reward-toIntegral").on("click",function(){var e=t("#toIntegral-template").html();a.init({content:e,close:!1,class_name:"layer-toIntegral",position:"center",closeEvent:function(){o.deletePushState("link")}}),o.pushState("link","toIntegral")}),t(document).on("click",".js-giftComtoReward",function(){var o=t(".giftcom_to_reward_amount").val(),e=t(".giftcom_to_reward_tpwd").val();o=parseInt(o)?parseInt(o):"",a.showConfirm("确定转换成余额？",function(){a.showLoad(!0);t.ajaxPost("/api/account/giftComtoReward",{amount:o,transaction_password:e},function(t){a.hideLoad(),"Success"==t.code?(a.showTip(t.message,3e3,"success"),window.location.reload()):""!=t.message&&a.showTip(t.message,3e3,"error")})})}),t(".js-show-giftComtoReward").on("click",function(){var e=t("#giftComtoReward-template").html();a.init({content:e,close:!1,class_name:"layer-giftComtoReward",position:"center",closeEvent:function(){o.deletePushState("link")}}),o.pushState("link","giftComtoReward")}),t(document).on("click",".js-giftComtoGold",function(){var o=t(".giftcom_to_gold_number").val(),e=t(".giftcom_to_gold_tpwd").val();o=parseInt(o)?parseInt(o):"",a.showConfirm("确定置换？",function(){a.showLoad(!0);t.ajaxPost("/api/account/giftComtoGold",{gold_number:o,transaction_password:e},function(t){a.hideLoad(),"Success"==t.code?(a.showTip(t.message,3e3,"success"),window.location.reload()):""!=t.message&&a.showTip(t.message,3e3,"error")})})}),t(".js-show-giftComtoGold").on("click",function(){var e=t("#giftComtoGold-template").html();a.init({content:e,close:!1,class_name:"layer-giftComtoGold",position:"center",closeEvent:function(){o.deletePushState("link")}}),o.pushState("link","giftComtoGold")}),t(".js-show-transfer-code").on("click",function(){var e=t(this).attr("data-type");if("1"!=e)return a.showTip("开通vip可以互相转账自由交易积分！"),!1;var n=t("#transfer-code-box-template").html();a.init({content:n,close:!1,class_name:"layer-qr layer-top bottom-to-top",position:"top",callback:function(){},closeEvent:function(){o.deletePushState("link")}}),o.pushState("link","transfer")}),t(".js-integral-transfer").on("click",function(){var o=t(this).attr("data-type");return"1"!=o?(a.showTip("开通vip可以互相转账自由交易积分！"),!1):void(window.location.href=t(this).attr("data-href"))}),t.ajaxGet("/api/account/orderCount",{},function(o){var a=o.data;a.pending&&t(".order-pending-number").html(a.pending).show(),a.shipping&&t(".order-shipping-number").html(a.shipping).show(),a.shipped&&t(".order-shipped-number").html(a.shipped).show(),a.review&&t(".order-review-number").html(a.review).show()}),t(window).on("popstate",function(o){var e=t(".layer-toIntegral");e.size()>0&&a.hideLayer(e);var n=t(".layer-qr");n.size()>0&&a.hideLayer(n);var r=t(".layerbox.show");r.size()>0&&a.hideLayer(r)}),t(".js-show-rupgrade").on("click",function(){var e=t("#torupgrade-template").html();a.init({content:e,close:!1,class_name:"layer-torupgrade",position:"center",closeEvent:function(){o.deletePushState("link")}}),o.pushState("link","torupgrade")}),t(document).on("click",".js-check-user",function(){var o=t.trim(t(".check-phone").val());t.post("/api/account/checkuser",{phone:o},function(o){"Success"==o.code?(t(".upgrade-msg").html(o.message),t(".upgrade-link").attr("href",o.data.link),t(".upgrade-info").show()):a.showTip(o.message,3e3,"error")},"json")})},avatarUload:function(o){var e=this,n=new FormData(o[0]);a.showLoad(),t.ajax({url:"/api/account/changeavatar",type:"POST",data:n,processData:!1,contentType:!1,success:function(n){a.hideLoad(),e.uploadCallback(o),"Success"==n.code?window.location.reload():(a.showTip(n.message,5e3,"error"),t.showRequestError(n))},error:function(t){a.hideLoad(),e.uploadCallback(o),a.showTip("上传失败",5e3,"error")}})},uploadCallback:function(t){var o=t.find("input[type=file]");o.after(o.clone().val("")),o.remove()},pushState:function(o,a){if(history&&history.pushState){var e=window.location.search;e=t.changeURLArg(e,o,a);var n=window.location.pathname+e+window.location.hash;history.pushState({title:document.title,url:n},document.title,n)}},deletePushState:function(o){if(history&&history.pushState){var a=window.location.search;a=t.delParam(a,o);var e=window.location.pathname+a+window.location.hash;history.pushState({title:document.title,url:e},document.title,e)}},initInfo:function(){a.showLoad(),t.ajaxGet("/api/account/info",{},function(o){a.hideLoad();var e=o.data.reward,n=o.data.currency+e;t(".reward_amount").html(n);var r=o.data.integral,i=o.data.currency+r;t(".integral_amount").html(i);var s=o.data.rf_count;t(".rf-count").html(s);var c=o.data.rf_month_count;t(".rf-month-count").html(c);var l=o.data.rf_second_count;t(".rf-second-count").html(l);var d=o.data.rf_second_month_count;t(".rf-second-month-count").html(d);var u=o.data.rf_s_count;t(".rf-s-count").html(u);var h=o.data.rf_s_month_count;t(".rf-s-month-count").html(h)})}},n={upload_image_format_tip:"请上传图片格式的文件！",upload_maximum_tip:"图片不能超过10 MB"};"function"==typeof e.init&&t(function(){e.init()})});