require(["zepto","base","mylayer","validate"],function(e,r,s,t){var a={init:function(){var r=this;e(".tab-item").on("click",function(r){var s=e(this),t=e(this).closest(".box-tab").find(".tab-content>div"),a=s.index();s.addClass("current").siblings(".tab-item").removeClass("current"),t.eq(a).addClass("current").siblings("div").removeClass("current")});new FormValidator("account-setting-form",[{name:"fullname",rules:"required|is_letter"}],function(t,a){var i=e(a.target);if(i.find(".errormsg").html(""),t.length>0)return r.showValidatorError(t,i),!1;var o=i.attr("data-action"),n=(s.showLoad(!0),i.serializeObject()),d=e(".qr-image").attr("src");d&&(n.weixin_qr=d),e.ajaxPost(o,n,function(r){s.hideLoad(),"Success"==r.code?s.showTip(r.message,3e3,"success"):e.showRequestError(r)},function(r){s.hideLoad(),e.showRequestError(r)})});e(".account-setting-form").on("submit",function(){return!1});new FormValidator("alert-password-form",[{name:"password_old",rules:"required",message:{required:"请输入旧密码"}},{name:"password",rules:"required|min_length[6]|max_length[50]",message:{required:"请输入新密码",min_length:"密码至少6位数"}},{name:"confirm_password",rules:"required|matches[password]",message:{required:"请输入确认密码",matches:"密码不一致"}}],function(t,a){var i=e(a.target);if(i.find(".errormsg").html(""),t.length>0)return r.showValidatorError(t,i),!1;var o=i.attr("data-action"),n=i.serializeObject();s.showLoad(!0);e.ajaxPost(o,n,function(r){s.hideLoad(),"Success"==r.code?s.showTip(r.message,3e3,"success"):e.showRequestError(r)},function(r){s.hideLoad(),e.showRequestError(r)})});e(".account-password-form").on("submit",function(){return!1}),e(".js-change-qt").on("click",function(){e(".qr-upload-file").click()}),e(".qr-upload-form").on("change",function(r){var t=(e(this),r||window.event),a=e(t.target||t.srcElement);if(a.hasClass("qr-upload-file"))try{var i=a[0].files;if(i&&i.length>0){if(!i[0].type||e.inArray(i[0].type,["image/png","image/gif","image/jpg","image/jpeg"])==-1)return s.showTip(tipMessage.upload_image_format_tip,5e3,"error"),!1;if(i[0].size){var o=i[0].size/1048576;if(o>3)return s.showTip(tipMessage.upload_maximum_tip,5e3,"error"),!1}}var n=i[0],d=new FileReader;d.readAsDataURL(n),d.onload=function(r){var s=this.result;e(".qr-image");e(".qr-image").attr("src",s)}}catch(e){}});new FormValidator("weixin-info-form",[{name:"weixin",rules:"is_letter"}],function(t,a){var i=e(a.target);if(i.find(".errormsg").html(""),t.length>0)return r.showValidatorError(t,i),!1;var o=i.serializeObject(),n=e(".qr-image").attr("src");n&&(o.weixin_qr=n);s.showLoad(!0);e.ajaxPost("/api/account/changeWeixin",o,function(r){s.hideLoad(),"Success"==r.code?s.showTip(r.message,3e3,"success"):e.showRequestError(r)},function(r){s.hideLoad(),e.showRequestError(r)})});e(".weixin-info-form").on("submit",function(){return!1}),e(".js-send-phonecode").on("click",function(){var t=e(this);if(t.hasClass("disabled"))return!1;if(t.hasClass("is_send"))return!1;var a=e.trim(e(".reset_phone").val());return""==a?(s.showTip("请先输入手机号码","3000","error"),!1):(t.addClass("disabled"),e(".code_send_tip_info").hide(),void e.ajaxPost("/api/auth/phone/code",{phone:a,type:"transaction_password"},function(a){"Success"==a.code?(e(".verificate_code_time").text("60"),e(".code_send_tip_info").show(),e(".code_send_tip").html(a.message),r.VerificateCodeInterval(t)):""!=a.message?(t.removeClass("disabled"),s.showTip(a.message,"3000","error")):t.removeClass("disabled")}))});new FormValidator("alert-tpwd-form",[{name:"code",rules:"required",message:{required:"请输入验证码"}},{name:"password",rules:"required|numeric|min_length[6]|max_length[6]",message:{required:"请输入6位数字的密码",min_length:"请输入6位数字的密码",max_length:"请输入6位数字的密码"}},{name:"confirm_password",rules:"required|matches[password]",message:{required:"请输入6位数字的确认密码",matches:"密码不一致"}}],function(t,a){var i=e(a.target);if(i.find(".errormsg").html(""),t.length>0)return r.showValidatorError(t,i),!1;var o=i.attr("data-action"),n=i.serializeObject();s.showLoad(!0);e.ajaxPost(o,n,function(r){s.hideLoad(),"Success"==r.code?(s.showTip(r.message,3e3,"success"),window.location.reload()):e.showRequestError(r)},function(r){s.hideLoad(),e.showRequestError(r)})});e(".alert-tpwd-form").on("submit",function(){return!1})},VerificateCodeInterval:function(r){var s=60,t=setInterval(function(){s>0&&(s-=1,e(".verificate_code_time").text(s)),s<=0&&(clearInterval(t),r.removeClass("disabled"),e(".code_send_tip_info").hide())},1e3)},showValidatorError:function(r,s){for(var t=0,a=r.length;t<a;t++){var i=e(r[t].element);0==i.next(".errormsg").size()&&i.after('<div class="errormsg"></div>'),i.next(".errormsg").html(r[t].message)}var o=s.offset().top;window.scrollTo(0,o)}};"function"==typeof a.init&&e(function(){a.init()})});