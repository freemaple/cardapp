require(["zepto","base","mylayer","validate","scrollComponent","lazyload"],function(a,t,o,n,i,e){var l={init:function(){var t=this;a(".js-show-qr").on("click",function(){var t=a("#qr-box-template").html();o.init({content:t,close:!1,class_name:"layer-qr layer-bottom bottom-to-top",position:"bottom",callback:function(){}})}),a(".js-show-weixin").on("click",function(){var t=a("#weixin-box-template").html();o.init({content:t,close:!1,class_name:"layer-weixin layer-bottom bottom-to-top",position:"bottom",callback:function(){}})}),a(".musicBtn").on("click",function(){var o=a(this);o.attr("data-play")&&"1"==o.attr("data-play")?(t.stop(),a(this).removeAttr("data-play"),o.removeClass("play")):(t.music(),a(this).attr("data-play","1"),o.addClass("play"))}),a(".simple-microlink-item svg").attr("fill",function(){return"#ffffff"}),a(".js-avatar-edit").on("click",function(){a(".avatar-upload-file").click()}),a(".avatar-upload-file").on("change",function(n){var i=a(".avatar-upload-form"),e=a(this);try{var l=e[0].files;if(l&&l.length>0){if(!l[0].type||a.inArray(l[0].type,["image/png","image/gif","image/jpg","image/jpeg"])==-1)return o.showTip("请上传图片格式",5e3,"error"),!1;if(l[0].size){var r=l[0].size/1048576;if(r>5)return o.showTip("图片文件不能超过5M",5e3,"error"),!1}}t.avatarUload(i)}catch(a){}}),a(".js-show-map-view").on("click",function(){var t=a("#card_address"),n=t.attr("data-province"),i=t.attr("data-city"),e=t.attr("data-district"),l=t.attr("data-address-street"),c=n+i+e+l;if(null==c)return o.showTip("用户未设置地址！",3e3,"error"),!1;var s=a("#map-template").html();o.init({content:s,close:!1,class_name:"layer-map",position:"top",callback:function(){r.init(c)}})}),this.post()},post:function(){var t=this,o=a(".js-post-list-box");a("#card_id").val();o.addClass("loading"),o.find(".js-load-block").show();var n=o.attr("data-action");a.ajaxGet(n,{page:"1"},function(t){o.removeClass("loading"),o.find(".js-load-block").hide(),""!=t.view&&(a(".card-post-box").show(),o.find(".js-card-post-list").html(t.view)),a.imgLazyLoad()}),i.init(),i.setScrollItem(o),i.setCallback(function(a,o){t.scrollLoadCallback(a,o)})},stop:function(){var a=document.getElementById("card-music-audio");a.currentTime=0,a.pause()},music:function(){var a=document.getElementById("card-music-audio");null!=a&&(a.load(),a.play())},scrollLoadCallback:function(t,o){o.find(".js-card-post-list").append(t),a.imgLazyLoad()},uploadCallback:function(a){var t=a.find("input[type=file]");t.after(t.clone().val("")),t.remove()},avatarUload:function(t){var n=this,i=new FormData(t[0]);o.showLoad(),a.ajax({url:"/api/account/changeavatar",type:"POST",data:i,processData:!1,contentType:!1,success:function(i){o.hideLoad(),n.uploadCallback(t),"Success"==i.code?window.location.reload():a.showRequestError(i)},error:function(i){o.hideLoad(),n.uploadCallback(t),a.showRequestError(i)}})}},r={init:function(a){var t,o=new BMap.Map("allmap"),n=new BMap.Geocoder;a&&n.getPoint(a,function(a){if(a){o.centerAndZoom(a,16),t=new BMap.Marker(a),o.addOverlay();var n=new BMap.InfoWindow("");t.addEventListener("click",function(){this.openInfoWindow(n)})}}),o.addControl(new BMap.MapTypeControl({mapTypes:[BMAP_NORMAL_MAP,BMAP_HYBRID_MAP]})),o.enableScrollWheelZoom(!0);new BMap.ContextMenu}};a(function(){l.init()})});