/*
colpick Color Picker / colpick.com
Copyright 2013 Jose Vargas. Licensed under GPL license.
	
	This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.

Based on Stefan Petre's Color Picker www.eyecon.ro, dual licensed under the MIT and GPL licenses
 */

!function(t){var a=function(){var a='<div class="colpick"><div class="colpick_color"><div><div></div></div></div><div class="colpick_hue"><div></div></div><div class="colpick_new_color"></div><div class="colpick_current_color"></div><div class="colpick_hex_field"><div>#</div><input type="text" maxlength="6" size="6" /></div><div class="colpick_rgb_r colpick_field"><div>R</div><input type="text" maxlength="3" size="3" /><span></span></div><div class="colpick_rgb_g colpick_field"><div>G</div><input type="text" maxlength="3" size="3" /><span></span></div><div class="colpick_rgb_b colpick_field"><div>B</div><input type="text" maxlength="3" size="3" /><span></span></div><div class="colpick_hsb_h colpick_field"><div>H</div><input type="text" maxlength="3" size="3" /><span></span></div><div class="colpick_hsb_s colpick_field"><div>S</div><input type="text" maxlength="3" size="3" /><span></span></div><div class="colpick_hsb_b colpick_field"><div>B</div><input type="text" maxlength="3" size="3" /><span></span></div><div class="colpick_submit"></div></div>',o={showEvent:"click",onShow:function(){},onBeforeShow:function(){},onHide:function(){},onChange:function(){},onSubmit:function(){},colorScheme:"light",color:"11ff00",livePreview:!0,flat:!1,layout:"full",submit:1,submitText:"OK",height:150},i=function(a,o){var i=O(a);t(o).data("colpick").fields.eq(1).val(i.r).end().eq(2).val(i.g).end().eq(3).val(i.b).end()},e=function(a,o){t(o).data("colpick").fields.eq(4).val(Math.round(10*a.h)/10).end().eq(5).val(Math.round(10*a.s)/10).end().eq(6).val(Math.round(10*a.b)/10).end()},c=function(a,o){t(o).data("colpick").fields.eq(0).val(H(a))},l=function(a,o){t(o).data("colpick").selector.css("backgroundColor","#"+H({h:a.h,s:100,b:100})),t(o).data("colpick").selectorIndic.css({left:parseInt(t(o).data("colpick").height*a.s/100,10),top:parseInt(t(o).data("colpick").height*(100-a.b)/100,10)})},n=function(a,o){t(o).data("colpick").hue.css("top",parseInt(t(o).data("colpick").height-t(o).data("colpick").height*a.h/360,10))},d=function(a,o){t(o).data("colpick").currentColor.css("backgroundColor","#"+H(a))},r=function(a,o){t(o).data("colpick").newColor.css("backgroundColor","#"+H(a))},s=function(a){var o,d=t(this).parent().parent();this.parentNode.className.indexOf("_hex")>0?d.data("colpick").color=o=N(S(this.value)):this.parentNode.className.indexOf("_hsb")>0?d.data("colpick").color=o=C({h:parseInt(d.data("colpick").fields.eq(4).val(),10),s:parseInt(d.data("colpick").fields.eq(5).val(),10),b:parseInt(d.data("colpick").fields.eq(6).val(),10)}):d.data("colpick").color=o=z(q({r:parseInt(d.data("colpick").fields.eq(1).val(),10),g:parseInt(d.data("colpick").fields.eq(2).val(),10),b:parseInt(d.data("colpick").fields.eq(3).val(),10)})),a&&(i(o,d.get(0)),c(o,d.get(0)),e(o,d.get(0))),l(o,d.get(0)),n(o,d.get(0)),r(o,d.get(0)),d.data("colpick").onChange.apply(d.parent(),[o,H(o),O(o)])},p=function(a){t(this).parent().removeClass("colpick_focus")},h=function(){t(this).parent().parent().data("colpick").fields.parent().removeClass("colpick_focus"),t(this).parent().addClass("colpick_focus")},u=function(a){var o=t(this).parent().find("input").focus(),i={el:t(this).parent().addClass("colpick_slider"),max:this.parentNode.className.indexOf("_hsb_h")>0?360:this.parentNode.className.indexOf("_hsb")>0?100:255,y:a.pageY,field:o,val:parseInt(o.val(),10),preview:t(this).parent().parent().data("colpick").livePreview};t(document).mouseup(i,v),t(document).mousemove(i,f)},f=function(t){return t.data.field.val(Math.max(0,Math.min(t.data.max,parseInt(t.data.val-t.pageY+t.data.y,10)))),t.data.preview&&s.apply(t.data.field.get(0),[!0]),!1},v=function(a){return s.apply(a.data.field.get(0),[!0]),a.data.el.removeClass("colpick_slider").find("input").focus(),t(document).off("mouseup",v),t(document).off("mousemove",f),!1},g=function(a){var o={cal:t(this).parent(),y:t(this).offset().top};o.preview=o.cal.data("colpick").livePreview,t(document).mouseup(o,m),t(document).mousemove(o,k),s.apply(o.cal.data("colpick").fields.eq(4).val(parseInt(360*(o.cal.data("colpick").height-(a.pageY-o.y))/o.cal.data("colpick").height,10)).get(0),[o.preview])},k=function(t){return s.apply(t.data.cal.data("colpick").fields.eq(4).val(parseInt(360*(t.data.cal.data("colpick").height-Math.max(0,Math.min(t.data.cal.data("colpick").height,t.pageY-t.data.y)))/t.data.cal.data("colpick").height,10)).get(0),[t.data.preview]),!1},m=function(a){return i(a.data.cal.data("colpick").color,a.data.cal.get(0)),c(a.data.cal.data("colpick").color,a.data.cal.get(0)),t(document).off("mouseup",m),t(document).off("mousemove",k),!1},b=function(a){a.preventDefault?a.preventDefault():a.returnValue=!1;var o={cal:t(this).parent(),pos:t(this).offset()};o.preview=o.cal.data("colpick").livePreview,t(document).mouseup(o,x),t(document).mousemove(o,_),s.apply(o.cal.data("colpick").fields.eq(6).val(parseInt(100*(o.cal.data("colpick").height-(a.pageY-o.pos.top))/o.cal.data("colpick").height,10)).end().eq(5).val(parseInt(100*(a.pageX-o.pos.left)/o.cal.data("colpick").height,10)).get(0),[o.preview])},_=function(t){return s.apply(t.data.cal.data("colpick").fields.eq(6).val(parseInt(100*(t.data.cal.data("colpick").height-Math.max(0,Math.min(t.data.cal.data("colpick").height,t.pageY-t.data.pos.top)))/t.data.cal.data("colpick").height,10)).end().eq(5).val(parseInt(100*Math.max(0,Math.min(t.data.cal.data("colpick").height,t.pageX-t.data.pos.left))/t.data.cal.data("colpick").height,10)).get(0),[t.data.preview]),!1},x=function(a){return i(a.data.cal.data("colpick").color,a.data.cal.get(0)),c(a.data.cal.data("colpick").color,a.data.cal.get(0)),t(document).off("mouseup",x),t(document).off("mousemove",_),!1},w=function(a){var o=t(this).parent(),i=o.data("colpick").color;o.data("colpick").origColor=i,d(i,o.get(0)),o.data("colpick").onSubmit(i,H(i),O(i),o.data("colpick").el)},y=function(a){var o=t("#"+t(this).data("colpickId"));o.data("colpick").onBeforeShow.apply(this,[o.get(0)]);var i=t(this).offset(),e=i.top+this.offsetHeight,c=i.left,l=I();return c+346>l.l+l.w&&(c-=346),o.css({left:c+"px",top:e+"px"}),0!=o.data("colpick").onShow.apply(this,[o.get(0)])&&o.show(),t("html").mousedown({cal:o},M),o.mousedown(function(t){t.stopPropagation()}),!1},M=function(a){return 0!=a.data.cal.data("colpick").onHide.apply(this,[a.data.cal.get(0)])&&a.data.cal.hide(),t("html").off("mousedown",M),!1},I=function(){var t="CSS1Compat"==document.compatMode;return{l:window.pageXOffset||(t?document.documentElement.scrollLeft:document.body.scrollLeft),w:window.innerWidth||(t?document.documentElement.clientWidth:document.body.clientWidth)}},C=function(t){return{h:Math.min(360,Math.max(0,t.h)),s:Math.min(100,Math.max(0,t.s)),b:Math.min(100,Math.max(0,t.b))}},q=function(t){return{r:Math.min(255,Math.max(0,t.r)),g:Math.min(255,Math.max(0,t.g)),b:Math.min(255,Math.max(0,t.b))}},S=function(t){var a=6-t.length;if(a>0){for(var o=[],i=0;i<a;i++)o.push("0");o.push(t),t=o.join("")}return t},P=function(t){var t=parseInt(t.indexOf("#")>-1?t.substring(1):t,16);return{r:t>>16,g:(65280&t)>>8,b:255&t}},N=function(t){return z(P(t))},z=function(t){var a={h:0,s:0,b:0},o=Math.min(t.r,t.g,t.b),i=Math.max(t.r,t.g,t.b),e=i-o;return a.b=i,a.s=0!=i?255*e/i:0,0!=a.s?t.r==i?a.h=(t.g-t.b)/e:t.g==i?a.h=2+(t.b-t.r)/e:a.h=4+(t.r-t.g)/e:a.h=-1,a.h*=60,a.h<0&&(a.h+=360),a.s*=100/255,a.b*=100/255,a},O=function(t){var a={},o=Math.round(t.h),i=Math.round(255*t.s/100),e=Math.round(255*t.b/100);if(0==i)a.r=a.g=a.b=e;else{var c=e,l=(255-i)*e/255,n=(c-l)*(o%60)/60;360==o&&(o=0),o<60?(a.r=c,a.b=l,a.g=l+n):o<120?(a.g=c,a.b=l,a.r=c-n):o<180?(a.g=c,a.r=l,a.b=l+n):o<240?(a.b=c,a.r=l,a.g=c-n):o<300?(a.b=c,a.g=l,a.r=l+n):o<360?(a.r=c,a.g=l,a.b=c-n):(a.r=0,a.g=0,a.b=0)}return{r:Math.round(a.r),g:Math.round(a.g),b:Math.round(a.b)}},Y=function(a){var o=[a.r.toString(16),a.g.toString(16),a.b.toString(16)];return t.each(o,function(t,a){1==a.length&&(o[t]="0"+a)}),o.join("")},H=function(t){return Y(O(t))},B=function(){var a=t(this).parent(),o=a.data("colpick").origColor;a.data("colpick").color=o,i(o,a.get(0)),c(o,a.get(0)),e(o,a.get(0)),l(o,a.get(0)),n(o,a.get(0)),r(o,a.get(0))};return{init:function(f){if(f=t.extend({},o,f||{}),"string"==typeof f.color)f.color=N(f.color);else if(void 0!=f.color.r&&void 0!=f.color.g&&void 0!=f.color.b)f.color=z(f.color);else{if(void 0==f.color.h||void 0==f.color.s||void 0==f.color.b)return this;f.color=C(f.color)}return this.each(function(){if(!t(this).data("colpickId")){var o=t.extend({},f);o.origColor=f.color;var v="collorpicker_"+parseInt(1e3*Math.random());t(this).data("colpickId",v);var k=t(a).attr("id",v);k.addClass("colpick_"+o.layout+(o.submit?"":" colpick_"+o.layout+"_ns")),"light"!=o.colorScheme&&k.addClass("colpick_"+o.colorScheme),k.find("div.colpick_submit").html(o.submitText).click(w),o.fields=k.find("input").change(s).blur(p).focus(h),k.find("span").mousedown(u).end().find(">div.colpick_current_color").click(B),o.selector=k.find("div.colpick_color").mousedown(b),o.selectorIndic=o.selector.find("div div"),o.el=this,o.hue=k.find("div.colpick_hue div"),k.find("div.colpick_hue").mousedown(g),o.newColor=k.find("div.colpick_new_color"),o.currentColor=k.find("div.colpick_current_color"),k.data("colpick",o),i(o.color,k.get(0)),e(o.color,k.get(0)),c(o.color,k.get(0)),n(o.color,k.get(0)),l(o.color,k.get(0)),d(o.color,k.get(0)),r(o.color,k.get(0)),o.flat?(k.appendTo(this).show(),k.css({position:"relative",display:"block"})):(k.appendTo(document.body),t(this).on(o.showEvent,y),k.css({position:"absolute"}))}})},showPicker:function(){return this.each(function(){t(this).data("colpickId")&&y.apply(this)})},hidePicker:function(){return this.each(function(){t(this).data("colpickId")&&t("#"+t(this).data("colpickId")).hide()})},setColor:function(a){if("string"==typeof a)a=N(a);else if(void 0!=a.r&&void 0!=a.g&&void 0!=a.b)a=z(a);else{if(void 0==a.h||void 0==a.s||void 0==a.b)return this;a=C(a)}return this.each(function(){if(t(this).data("colpickId")){var o=t("#"+t(this).data("colpickId"));o.data("colpick").color=a,o.data("colpick").origColor=a,i(a,o.get(0)),e(a,o.get(0)),c(a,o.get(0)),n(a,o.get(0)),l(a,o.get(0)),d(a,o.get(0)),r(a,o.get(0))}})}}}();t.fn.extend({colpick:a.init,colpickHide:a.hidePicker,colpickShow:a.showPicker,colpickSetColor:a.setColor})}(jQuery);