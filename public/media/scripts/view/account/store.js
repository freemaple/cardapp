require(["zepto","base","mylayer","validate"],function(e,r,a,t){var i={init:function(){var r=this,t=e("#distpicker"),i={province:t.attr("data-province"),city:t.attr("data-city"),district:t.attr("data-district")};require(["jquery","distpicker"],function(e){e("#distpicker").distpicker(i)});new FormValidator("store-info-form",r.storeFormRule,function(t,i){var o=e(i.target);if(o.find(".errormsg").html(""),t.length>0)return r.showValidatorError(t,o),!1;var n=(a.showLoad(!0),new FormData(o[0]));e.ajax({url:"/api/store/saveInfo",type:"POST",data:n,processData:!1,contentType:!1,success:function(r){"Success"==r.code?(a.showTip(r.message,3e3,"success"),window.location.href="/account/store"):(a.hideLoad(),e.showRequestError(r))},error:function(r){a.hideLoad(),e.showRequestError(r)}})});e(".store-info-form").on("submit",function(){return!1}),e(".js-store-banner-upload").on("click",function(){e(".store-banner-file").click()}),e(".store-banner-upload-form").on("change",function(t){var i=e(this),o=t||window.event,n=e(o.target||o.srcElement);if(n.hasClass("store-banner-file"))try{var s=n[0].files;if(s&&s.length>0){if(!s[0].type||e.inArray(s[0].type,["image/png","image/gif","image/jpg","image/jpeg"])==-1)return a.showTip(tipMessage.upload_image_format_tip,5e3,"error"),!1;if(s[0].size){var u=s[0].size/1048576;if(u>3)return a.showTip(tipMessage.upload_maximum_tip,5e3,"error"),!1}}r.bannerUload(i)}catch(e){}})},storeFormRule:[{name:"name",rules:"required|max_length[50]",message:{required:"请输入店铺名称！"}},{name:"contact_user_name",rules:"required|max_length[50]",message:{required:"请输入姓名！"}},{name:"contact_phone",rules:"required|numeric|max_length[50]",message:{required:"请输入手机号码！",numeric:"请输入手机号码！"}},{name:"province",rules:"required",message:{required:"请选择省份！"}},{name:"city",rules:"required",message:{required:"请选择城市！"}},{name:"district",rules:"required",message:{required:"请选择区！"}},{name:"address",rules:"required",message:{required:"请输入地址！"}},{name:"business_entity_name",rules:"required",message:{required:"请输入主营主体"}}],showValidatorError:function(r,a){for(var t=0,i=r.length;t<i;t++){var o=e(r[t].element);0==o.next(".errormsg").size()&&o.after('<div class="errormsg"></div>'),o.next(".errormsg").html(r[t].message)}var n=a.offset().top;window.scrollTo(0,n)},bannerUload:function(r){var t=this,i=new FormData(r[0]);a.showLoad(),e.ajax({url:"/api/store/changebanner",type:"POST",data:i,processData:!1,contentType:!1,success:function(i){a.hideLoad(),t.uploadCallback(r),"Success"==i.code?window.location.reload():e.showRequestError(i)},error:function(i){a.hideLoad(),t.uploadCallback(r),e.showRequestError(i)}})},uploadCallback:function(e){var r=e.find("input[type=file]");r.after(r.clone().val("")),r.remove()}};"function"==typeof i.init&&e(function(){i.init()})});